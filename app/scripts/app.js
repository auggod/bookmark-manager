// Generated by LiveScript 1.3.1
(function(){
  var app;
  chrome.webRequest.onHeadersReceived.addListener(function(info){
    var headers, i, header;
    headers = info.responseHeaders;
    i = headers.length - 1;
    while (i >= 0) {
      header = headers[i].name.toLowerCase();
      if (header === 'x-frame-options' || header === 'frame-options') {
        console.log('removed x-frame-options');
        headers.splice(i, 1);
      }
      --i;
    }
    return {
      responseHeaders: headers
    };
  }, {
    urls: ['*://*/*'],
    types: ['sub_frame']
  }, ['blocking', 'responseHeaders']);
  app = angular.module('BookmarksManagerApp', []);
  app.config(function($compileProvider){
    return $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension):/);
  });
  app.directive('checkUrl', function(){
    return {
      link: function(scope, element, attrs){
        var sites, isFrameNotAllowed;
        sites = [
          {
            'name': 'github.com'
          }, {
            'name': 'stackoverflow.com'
          }, {
            'name': 'programmers.stackexchange.com'
          }, {
            'name': 'medium.com'
          }
        ];
        isFrameNotAllowed = _.result(_.find(sites, {
          'name': scope.bookmark.url.split('/')[2]
        }), 'name');
        element.bind('mouseenter', function(event){
          if (isFrameNotAllowed) {
            element.addClass('no-frames-allowed');
          }
          return element.bind('mouseleave', function(event){
            return element.removeClass('no-frames-allowed');
          });
        });
        return element.bind('click', function(event){
          return scope.showView(scope.bookmark.url);
        });
      }
    };
  });
  app.directive('visited', function(){
    return {
      link: function(scope, element, attrs){
        return element.bind('click', function(event){
          event.preventDefault();
          return element.addClass('visited');
        });
      }
    };
  });
  app.controller('MainCtrl', [
    '$sce', '$scope', function($sce, $scope){
      $scope.bookmarks = [];
      $scope.clicks = [];
      $scope.trustSrc = function(src){
        return $sce.trustAsResourceUrl(src);
      };
      $scope.showView = function(url){
        $scope.viewUrl = url;
        return $scope.$apply();
      };
      return chrome.bookmarks.getRecent(1000, function(data){
        $scope.bookmarks = data;
        $scope.viewUrl = $scope.bookmarks[0].url;
        return $scope.$apply();
      });
    }
  ]);
}).call(this);
